<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1a1a1a">
    <title>Airsoft Tactical - Version Simple</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #1a1a1a; color: #00ff00; overflow: hidden; }
        
        #map { width: 100%; height: 100vh; }
        
        .team-setup {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95); padding: 30px; border-radius: 15px;
            border: 2px solid #00ff00; text-align: center; z-index: 2000;
        }
        
        .team-setup input {
            width: 100%; padding: 10px; margin: 10px 0;
            background: rgba(0, 255, 0, 0.1); border: 2px solid #00ff00;
            border-radius: 5px; color: #00ff00; font-size: 16px;
        }
        
        .btn {
            padding: 10px 20px; background: rgba(0, 255, 0, 0.2);
            border: 2px solid #00ff00; color: #00ff00; border-radius: 20px;
            cursor: pointer; font-weight: bold; margin: 10px 5px;
        }
        
        .status {
            position: absolute; top: 20px; left: 20px; z-index: 1000;
            background: rgba(0, 0, 0, 0.9); padding: 15px; border-radius: 10px;
            border: 2px solid #00ff00; font-size: 12px;
        }
        
        .controls {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 10px; z-index: 1000;
        }
        
        .loading {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 18px; z-index: 2000; display: none;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    
    <div class="team-setup" id="teamSetup">
        <h3>üéØ AIRSOFT TACTICAL</h3>
        <p>Version test simplifi√©e</p>
        <input type="text" id="teamCode" placeholder="Code √©quipe" maxlength="10">
        <input type="text" id="playerName" placeholder="Votre indicatif" maxlength="5">
        <button class="btn" onclick="startApp()">D√âMARRER</button>
    </div>
    
    <div class="loading" id="loading">Chargement GPS...</div>
    
    <div class="status" id="status">
        <div>üì° Status: Initialisation...</div>
        <div id="gpsInfo">üìç GPS: En attente</div>
        <div id="teamInfo">üë• √âquipe: -</div>
    </div>
    
    <div class="controls" style="display: none;" id="controls">
        <button class="btn" onclick="centerMap()">CENTRER</button>
        <button class="btn" onclick="addTestMarker()">TEST MARKER</button>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    
    <script>
        let map, playerMarker, watchId;
        let currentPosition = null;
        let teamCode = '', playerName = '';
        
        function startApp() {
            teamCode = document.getElementById('teamCode').value.trim().toUpperCase();
            playerName = document.getElementById('playerName').value.trim().toUpperCase();
            
            if (!teamCode || !playerName) {
                alert('Veuillez remplir tous les champs');
                return;
            }
            
            // Masquer l'√©cran de setup
            document.getElementById('teamSetup').style.display = 'none';
            document.getElementById('loading').style.display = 'block';
            document.getElementById('controls').style.display = 'flex';
            
            // Initialiser la carte
            initMap();
            
            // D√©marrer le GPS
            startGeolocation();
            
            // Mettre √† jour le status
            updateStatus('üì° Status: Mode local actif');
            document.getElementById('teamInfo').textContent = `üë• √âquipe: ${teamCode} - ${playerName}`;
        }
        
        function initMap() {
            // Carte centr√©e sur Paris par d√©faut
            map = L.map('map').setView([48.8566, 2.3522], 15);
            
            // Couche de carte standard
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: ''
            }).addTo(map);
            
            console.log('‚úÖ Carte initialis√©e');
        }
        
        function startGeolocation() {
            if (!navigator.geolocation) {
                alert('G√©olocalisation non support√©e');
                return;
            }
            
            updateStatus('üì° Status: Recherche GPS...');
            
            const options = {
                enableHighAccuracy: true,
                maximumAge: 1000,
                timeout: 15000
            };
            
            // Position unique d'abord
            navigator.geolocation.getCurrentPosition(onLocationSuccess, onLocationError, options);
            
            // Puis surveillance continue
            watchId = navigator.geolocation.watchPosition(onLocationSuccess, onLocationError, options);
        }
        
        function onLocationSuccess(position) {
            document.getElementById('loading').style.display = 'none';
            
            currentPosition = {
                lat: position.coords.latitude,
                lng: position.coords.longitude,
                accuracy: Math.round(position.coords.accuracy)
            };
            
            updateStatus('üì° Status: GPS actif');
            document.getElementById('gpsInfo').textContent = 
                `üìç GPS: ${currentPosition.lat.toFixed(6)}, ${currentPosition.lng.toFixed(6)} (¬±${currentPosition.accuracy}m)`;
            
            // Mettre √† jour le marqueur du joueur
            updatePlayerMarker();
            
            // Centrer sur le joueur
            centerMap();
            
            console.log('‚úÖ Position obtenue:', currentPosition);
        }
        
        function onLocationError(error) {
            document.getElementById('loading').style.display = 'none';
            
            let errorMsg = 'Erreur GPS';
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    errorMsg = 'Permission GPS refus√©e';
                    alert('Veuillez autoriser la g√©olocalisation dans les param√®tres de votre navigateur');
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMsg = 'Position indisponible';
                    break;
                case error.TIMEOUT:
                    errorMsg = 'Timeout GPS';
                    break;
            }
            
            updateStatus(`üì° Status: ${errorMsg}`);
            console.error('‚ùå Erreur g√©olocalisation:', error);
            
            // Position de d√©monstration
            currentPosition = { lat: 48.8566, lng: 2.3522, accuracy: 999 };
            updatePlayerMarker();
        }
        
        function updatePlayerMarker() {
            if (!map || !currentPosition) return;
            
            // Supprimer l'ancien marqueur
            if (playerMarker) {
                map.removeLayer(playerMarker);
            }
            
            // Cr√©er un marqueur rouge pour le joueur
            const playerIcon = L.divIcon({
                className: '',
                html: `<div style="
                    width: 20px; height: 20px; background: #ff0000; 
                    border: 3px solid #fff; border-radius: 50%;
                    box-shadow: 0 0 15px #ff0000;
                "></div>`,
                iconSize: [20, 20],
                iconAnchor: [10, 10]
            });
            
            playerMarker = L.marker([currentPosition.lat, currentPosition.lng], {
                icon: playerIcon
            }).addTo(map);
            
            playerMarker.bindPopup(`
                <b>${playerName}</b><br>
                √âquipe: ${teamCode}<br>
                Pr√©cision: ${currentPosition.accuracy}m
            `);
            
            console.log('‚úÖ Marqueur joueur mis √† jour');
        }
        
        function centerMap() {
            if (map && currentPosition) {
                map.setView([currentPosition.lat, currentPosition.lng], 17, {
                    animate: true,
                    duration: 1
                });
                console.log('‚úÖ Carte centr√©e');
            }
        }
        
        function addTestMarker() {
            if (!map) return;
            
            // Ajouter un marqueur de test pr√®s du joueur
            const testLat = currentPosition ? currentPosition.lat + 0.001 : 48.8576;
            const testLng = currentPosition ? currentPosition.lng + 0.001 : 2.3532;
            
            const testIcon = L.divIcon({
                className: '',
                html: `<div style="
                    width: 16px; height: 16px; background: #00ff00; 
                    border: 2px solid #fff; border-radius: 50%;
                "></div>`,
                iconSize: [16, 16],
                iconAnchor: [8, 8]
            });
            
            const testMarker = L.marker([testLat, testLng], {
                icon: testIcon
            }).addTo(map);
            
            testMarker.bindPopup('Marqueur de test');
            console.log('‚úÖ Marqueur de test ajout√©');
        }
        
        function updateStatus(message) {
            document.getElementById('status').children[0].textContent = message;
        }
        
        // Nettoyage
        window.addEventListener('beforeunload', () => {
            if (watchId) {
                navigator.geolocation.clearWatch(watchId);
            }
        });
        
        console.log('üöÄ Application initialis√©e - Version simple');
    </script>
</body>
</html>